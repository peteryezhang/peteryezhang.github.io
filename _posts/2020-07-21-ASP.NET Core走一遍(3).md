---
layout:     post                    # 使用的布局（不需要改）
title:     ASP.NET Core走一遍(3)     # 标题 
subtitle:   从头到尾走一遍  #副标题
date:       2020-07-21             # 时间
author:     Peter                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - .NET Core
    
---


## 当我们在说创新的时候其实是在说什么

相比之前的ASP.NET，新来的Core有什么创新么？

根据MS官方的说法，ASP.NET Core **is** a redesign of ASP.NET 4.x。变得更兼容更快更强。  


| ASP\.NET Core                                                                                                              | ASP\.NET 4\.x                                                |
|----------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|
| Build for Windows, macOS, or Linux                                                                                         | Build for Windows                                            |
| Razor Pages is the recommended approach to create a Web UI as of ASP\.NET Core 2\.x\. See also MVC, Web API, and SignalR\. | Use Web Forms, SignalR, MVC, Web API, WebHooks, or Web Pages |
| Multiple versions per machine                                                                                              | One version per machine                                      |
| Develop with Visual Studio, Visual Studio for Mac, or Visual Studio Code using C\# or F\#                                  | Develop with Visual Studio using C\#, VB, or F\#             |
| Higher performance than ASP\.NET 4\.x                                                                                      | Good performance                                             |
| Use \.NET Core runtime                                                                                                     | Use \.NET Framework runtime                                  |

## Model Binding

Model Binding在React Vue.js等前端框架中是核心的概念。作为MS首推的`Razor view files/Razor Pages`自然也实现了类似的操作。  


### Model Binding能做些什么

+ Retrieves data from various sources such as route data, form fields, and query strings. - 从各种数据源直接获取数据，免去复杂的获取过程
+ Provides the data to controllers and Razor pages in method parameters and public properties. - 在controller 与 Razor之间传递参数
+ Converts string data to .NET types. - 将string自动转化为.NET类型
+ Updates properties of complex types.   

### [BindProperty] attribute

可用在`Controller`或者`PageModel`中的public property。  

```
public class EditModel : InstructorsPageModel
{
    [BindProperty]
    public Instructor Instructor { get; set; }
```
在2.1以及以后可以使用`[BindProperties]`作用在class的全局。  

```
[BindProperties(SupportsGet = true)]
public class CreateModel : InstructorsPageModel
{
    public Instructor Instructor { get; set; }
```  

### Data Source

+ [FromQuery] - Gets values from the query string.
+ [FromRoute] - Gets values from route data.
+ [FromForm] - Gets values from posted form fields.
+ [FromBody] - Gets values from the request body.
+ [FromHeader] - Gets values from HTTP headers.  

上述属性直接作用于property, **NOT** class/model.  

### Input formatters

如果想要让我们的`action`只接受特定类型的输入，就需要用到`Input formatters`.  

具体的，我们需要使用`Consumes`来指定需要的类型，如果`Consumes`为空，则使用HTTP 中的` Content-Type header`.  

```
[HttpPost]
[Consumes("application/xml")]
public ActionResult<Pet> Create(Pet pet)
```  

### [FromServices]

默认的，我们会在构造方法中DI注入需要的services，但是如果某些service只在某个方法中用到，我们可以使用`[FromServices]`在某些方法中传入。  

