---
layout:     post                    # 使用的布局（不需要改）
title:      Spring AOP的本质       # 标题 
subtitle:     之代理模式详解 #副标题
date:       2020-07-05             # 时间
author:     Peter                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - Spring
---

## 前言

众所周知，IOC AOP作为Spring核心设计模式一直以来是这类框架的重点。本篇文章将主要介绍AOP所依赖的核心设计模式-代理模式。 

## 什么是代理模式

在代理模式（Proxy Pattern）中，一个类代表另一个类的功能。这种类型的设计模式属于结构型模式。

在代理模式中，我们创建具有现有对象的对象，以便向外界提供功能接口。  

**意图**为其他对象提供一种代理以控制对这个对象的访问。  

**主要解决**在直接访问对象时带来的问题，比如说：要访问的对象在远程的机器上。在面向对象系统中，有些对象由于某些原因（比如对象创建开销很大，或者某些操作需要安全控制，或者需要进程外的访问），直接访问会给使用者或者系统结构带来很多麻烦，我们可以在访问此对象时加上一个对此对象的访问层。  

**何时使用**想在访问一个类时做一些控制。  

**如何解决**增加中间层。  

**注意事项:** 1、和适配器模式的区别：适配器模式主要改变所考虑对象的接口，而代理模式不能改变所代理类的接口。 2、和装饰器模式的区别：装饰器模式为了增强功能，而代理模式是为了加以控制。  

代理模式UML  
![avatar](https://www.runoob.com/wp-content/uploads/2014/08/proxy_pattern_uml_diagram.jpg)  


## 什么是动态代理模式

上述UML实际上是静态代理模式的实现。  

代理模式中的静态代理模式存在一些特点：  
1. 1个静态代理 只服务1种类型的目标对象
2. 若要服务多类型的目标对象，则需要为每种目标对象都实现一个静态代理对象  

在目标对象较多的情况下，若采用静态代理，则会出现 静态代理对象量多、代码量大，从而导致代码复杂的问题。  

设计动态代理类`（DynamicProxy）`时，不需要显式实现与目标对象类（RealSubject）相同的接口，而是将这种实现推迟到程序运行时由 `JVM`来实现。  
1. 即：在使用时再创建动态代理类 & 实例
2. 静态代理则是在代理类实现时就指定与目标对象类（RealSubject）相同的接口  

通过Java 反射机制的`method.invoke（）`，通过调用动态代理类对象方法，从而自动调用目标对象的方法。  

## 动态代理的分类

在Java中动态代理分为基于接口的和基于类的。  
1. 基于接口 - JDK
2. 基于类 - cglib
3. Java字节码 - Javassist

### `Proxy`

`Proxy`提供了创建动态代理类实例的静态方法。  


### `InvocationHandler`类

`InvocationHandler`是由代理实例的调用程序实现的接口。  

每个代理实例都有一个关联的调用处理程序，当在代理实例上调用方法时，调用方法会被编码并被分配到调用处理程序的`invoke`方法。  


## 什么是AOP

AOP为Aspect Oriented Programming的缩写，意为：面向切面编程，通过预编译方式和运行期间动态代理实现程序功能的统一维护的一种技术。  

### AOP在Spring中的应用

提供声明式事务，允许用户自定义切面。  

+ 横切关注点： 即跨越应用程序多个模块的功能。即与我们业务逻辑无关的但是需要关注的部分。比如日志，安全，缓存，事务等。
+ 切面(Aspect): 横切关注点被模块化的特殊对象，是一个**类**
+ 通知(Advice): 切面需要完成的工作，是类中的一个**方法**
+ 目标(Target): 被通知对象
+ 代理(Proxy): 向目标对象应用通知后创建的对象
+ 切入点(PointCut): 切面通知执行的“地点”
+ 连接点(JointPoint): 与切入点匹配的执行点。  

### 使用Spring实现AOP

1. 使用Spring的API接口

2. 使用自定义类来实现

3. 注解实现AOP：@Aspect 

